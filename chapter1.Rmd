---
title: "Portfolio Theory"
author: "Matt Brigida"
date: "November 27, 2015"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<!---
Note, much of the R code in this text was written long ago, when I wrote even worse R code than I do now.  The code works, but it is inefficient and ugly.  I decided not to rewrite it however, feeling it more important to get the text out and into students' hands.  If you can improve the code, please feel free.  Pull requests are always welcome.
-->


# Introduction

Despite 'theory' in the title, this course will teach you how to construct portfolios in the real world.  In fact, some of the most interesting topics in this course will be on how to implement the theories we have learned.  

Through this course the student will gain a working knowledge of what we mean by the term *risk* in finance.  There will be differing measures of risk depending on the assumptions you make about the world.  Then, for a given set of assumptions, risk will directly determine portfolio allocations.  We'll also cover an extension of this, where the resulting portfolio allocations will imply an equilibrium expected return for each asset (the CAPM).  An apt alternative title for this course would be 'Risk and its Implications'. 


## Risk and Return Over our History

Mosts texts in portfolio theory start with a chart of the rate of return on different asset classes over time.  We'll be no different. However, take care to note the point of this exercise is simply to get an intuitive feel of the idea that taking more risk grants a higher return.

Note, throughout this text we'll generally quote returns on an annual basis.  This is important, because to compare returns between any two investments, we must look at the returns over the same length of time.  Beware anyone who quotes you their return over (particularly) longer peiods than a year, "I doubled my money in 10 years".  This is somewhat decieving because a 100\% return in 10 years is only 7.18\% per year.

```{r riskReturnHistory, echo=FALSE, message = FALSE, warning = FALSE}
library(shiny)
library(dygraphs)
library(quantmod)
renderPlot({




})
```

### Arithmetic versus Geometric Returns

Given a time series of returns, we can calculate arithmetic and geometric average returns.  Each type of average return (arithmetic vs geometric) is trying to answer a different question.

#### Arithmetic average:

You may recall, if we are given a discrete probability density function which describes returns, we can calculate the expected, or average, return as $E(r) = \sum_{s=1}^N{p(s)r(s)}$ where $s$ denotes the state of the world, and $p(s)$ and $r(s)$ is the probability of that state, and the return in that state, respectively.

When we switch to a time series of historical returns, we assign each return observation as equally likely.  So if there are $T$ returns, then each has probability $\frac{1}{T}$.  Therefore, the arithmetic average return is:

$\bar{r} = \frac{1}{T}\sum_{t = 1}^T{r_t}$

#### Geometric average:



As a note, the geometric average is always less than or equal to the arithmetic average. The only case where the averages are equal is of all the returns being averaged are equal.  Can you prove this?  


### A Brief Note on Ergodicity 

You may point out that what we have just done is not really compelling evidence. We have looked at an historical sample of size 1, and implied that this must hold.  In fact, to make any sort of statement about the empirical relationship between risk and return we would need to sample many times from all possible histories, and then average over these histories.  Of course, we can only ever observe one history---an important distinction from empirical results in disciplines such as physics and chemistry.

However, if the time series are ergodic, then averaging over time gives the same result as averaging over possible histories. The very interested student can see Hamilton's *Time Series Analysis*.  

Later, however we'll also see theories which imply a similar risk/return relationship. This will lend credence to these earlier empirical observations.  

## Risk Premia

### The Standard Deviation

### The Sharpe Ratio

The Sharpe Ratio is the ratio of an investment's reward to is volatility. In other words, it is what you receive in excess of the risk-free rate scaled by the risk you have to take to get that return.

$Sharpe\ Ratio=\frac{Risk\ Premium}{Volatility}$

where the volatility is defined as the standard deviation of excess returns.

<!---insert app which will calculate historical sharpe ratios?-->

### How good of an approximation is the normal distribution?

The idea of the application below is that in what follows we'll assume that stock behaves according to the normal distribution (red dotted line).  The empirical distribution is how the stock actually behaved over the interval in which we calculated the stock's parameters (mean and standard deviation).

Try different stocks and start dates.  You'll generally find small stocks over short time intervals have very non-normal empirical distributions.  However, often large stocks over long periods will have non-normal distributions as well.  The question is, given this evidence, why do we assume the normal distribution, and is it incorrect to do so?  

```{r comparetoNormal, echo=FALSE}
## compare normal and empirical distributions 
#{{{
inputPanel(
  textInput("ticker1", "Stock Ticker", value = "GE"),
  dateInput("startDate1", "Start Date", value = "2015-01-01")
)

renderPlot({
library(tseries)
library(quantmod)
  
    x <- get.hist.quote(input$ticker1, start = input$startDate1, quote = "Close")
    x <- xts(x)
    r <- Delt(x, type = 'log')[-1]

    plot(density(r), main = "Normal versus Empirical Distribution", lty = 1, 
        col = 1, lwd = 2, xlab = "Log-Returns in %/100") #, sub = "Matthew Brigida; Clarion UofP")

    lines(density(rnorm(5e+05, mean = mean(r), sd = sd(r))), lty = 4, col = 2, 
        lwd = 2)

    legend("topright", c("Stock Return Density", "Normal Density"), col = c(1, 2), 
        lty = c(1, 4), lwd = c(2, 2))

    # cat("The sample skewness is", skewness(r), "\n")
    # cat("For a t-statistic of", skewness(r)/(sqrt(6/length(r))), "\n")
    # p1 <- 2 * (1 - pt(abs(skewness(r)/(sqrt(6/length(r)))), length(r) - 1))
    # cat("And a p-value of", p1, "\n")
    # cat("So we", ifelse(p1 < 0.05, "reject the null, and find the distribution is skewed.", 
    #     "do not reject the null, the distribution is symmetric."), "\n")
    # cat("\n")
    # 
    # cat("The sample excess kurtosis is", kurtosis(r)[1], "\n")
    # cat("For a t-statistic of", kurtosis(r)/(sqrt(24/length(r))), "\n")
    # p2 <- 2 * (1 - pt(abs(kurtosis(r)/(sqrt(24/length(r)))), length(r) - 1))
    # cat("And a p-value of", p2, "\n")
    # cat("So we", ifelse(p2 < 0.05, "reject the null, and find the distribution has fat tails.", 
    #     "do not reject the null, the distribution does not have fat tails."), 
    #     "\n")
    # cat("\n")
})    
#}}}
```


<br/>
<br/>
<br/>
<br/>



